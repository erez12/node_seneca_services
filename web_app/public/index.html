<html>
<head>
	<title></title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://code.angularjs.org/1.2.6/angular.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script>
		function ServerConnection(){
			var _socket = io.connect();

			_socket.on('connect', function() {
				console.log("connect");
			});

			return {
				on: (topic, callback) => { _socket.on(topic, callback); }
			}
		}
		function LocalConnection(){
			var callbacks = []

			return {
				on: (topic, callback) => {
					if (!callbacks[topic]) {
						callbacks[topic] = $.Callbacks();
					}

					callbacks[topic].add(callback);
				},
				notify: (topic, message) => callbacks[topic].fire(message)
			}
		}

		function ServerEventsService(){
			Object.assign(this, ServerConnection());
			// Object.assign(this, LocalConnection());
		}

	</script>
	<style type="text/css">
		.container {
	        padding-top:100px;
	    }
		#logger-tab{
		    max-height: 300px;
		    overflow-y:scroll;
		}
	</style>
	<script type="text/javascript">

		var app = angular.module('MyApp', []);

		app.service('ServerEvents', ServerEventsService);

		app.controller('loggerCtroller', function ($scope, ServerEvents) {
			var severityToClassMapping = {
	 		  	log: "list-group-item-info",
	 		  	warn: "list-group-item-warning",
	 		  	error: "list-group-item-danger"
 		  }
		  // Initial value
		  $scope.items = [{service: 'SYSTEM', message:'Waiting For Data...', severity: 'log'}];

		  $scope.prependLogItem = function (logItem){
		    $scope.items = [logItem].concat($scope.items);
			 $scope.$apply();
		  };

		  $scope.getLogClass = function (idx, list) {
			  return severityToClassMapping[list[idx].severity];
		  }

		  ServerEvents.on('log_event', $scope.prependLogItem);
		  (function (){
			  return;
			  // Test code
			  var _messageCount = 1;
			  var _severities = ['log', 'warn', 'error'];
			  var _severitiesIndex = 0;
			  var _services = ['foo', 'goo', 'moo'];
			  var _serviceIndex = 0;

			 setInterval(() => {
				 ServerEvents.notify('log_event', {
					 service: _services[_serviceIndex],
					 severity: _severities[_severitiesIndex],
					 message: _messageCount++
				 });
				 _severitiesIndex = (_severitiesIndex + 1) % _severities.length;
				 _serviceIndex = (_serviceIndex + 1) % _services.length;
			 }, 1000 * 5);
		  }());
		});

	</script>
</head>
<body  ng-app="MyApp">
	<div class="container">
		<div class="tab-content">
            <div ng-controller="loggerCtroller" class="tab-pane active" id="logger-tab" role="tabpanel">
            	<ul class="list-group">
            		<li class="list-group-item" ng-repeat="item in items" ng-class="getLogClass($index, items)">
            			{{item.service}}:: {{item.message}}
            		</li>
					</ul>
            </div>
        </div>
	</div>
</body>

</html>
<!-- <html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  	<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  	<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
  	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.0/css/bootstrap-toggle.min.css" rel="stylesheet">
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.0/js/bootstrap-toggle.min.js"></script>
  	<style type="text/css">
  		.head{
  			background-color:orange;
  			width:20px;
  		}
		.toggle {
    		width: 100%;
    		max-width: 100%;
		    position: relative;
		    border: 1px solid #ccc;
		    padding: 1em 1em 0.5em 1em;
		    border-radius: 4px 4px 0 0;
		}
  	</style>
</head>

<body>


	<div ng-app="myApp" ng-controller="myCtrl">
		<div class="container" style="width: 1270px">
			<div class="page-header">
	  			<h1>Mistel, stop spending all my money !!!</h1>
			</div>

		  	<table class="table table-striped table-bordered">
			    <thead>
			      <tr>
			        <th class="head">cmpId</th>

			        <th style="width:5px;font-size: 70%; background-color:darkorange;">Banker values</th>

			        <th class="head">available</th>
			        <th class="head">spent</th>

			        <th style="width:5px;font-size: 70%; background-color:darkorange;" class="head">Redis values</th>

			        <th class="head">total</th>
			        <th class="head">total_available</th>
			        <th class="head">daily_cap</th>
			        <th class="head">daily_available</th>
			        <th class="head">hourly_cap</th>
			        <th class="head">hourly_available</th>
			      </tr>
			    </thead>

			    <tbody>
			    	<tr ng-repeat="x in data | orderBy:sortType:sortReverse | filter:tableFilter">
					    <td>{{ x.cmpId }}</td>

					    <td></td>

					    <td>{{ x.available }}</td>
					    <td>{{ x.spent }}</td>

					    <td></td>

					    <td>{{ x.total }}</td>
					    <td>{{ x.total_available }}</td>
					    <td>{{ x.daily_cap }}</td>
					    <td>{{ x.daily_available }}</td>
					    <td>{{ x.hourly_cap }}</td>
					    <td>{{ x.hourly_available }}</td>
					</tr>
			    </tbody>
		  	</table>
		</div>
	</div>
</body>

<script>
  	var app = angular.module('myApp', []);
  	var USD = false;
  	function fixNumber(num){
  		num = (parseInt(num)/1000000 + "").split(".");
  		fixed = parseInt(num[0]).toLocaleString();
  		precision = num[1];
    	return fixed + "" + (precision ? ("." + precision) : "");
    }
  	function changeAmounts(data){
  		if (USD && !data.__valueInUSD){
	  		data.forEach(function (elem){
	  			elem._available = elem.available;
	  			elem.available = fixNumber(elem.available);
	  			elem._spent = elem.spent;
	  			elem.spent = fixNumber(elem.spent);
				elem._total = elem.total;
				elem.total = fixNumber(elem.total);
		    	elem._total_available = elem.total_available;
		    	elem.total_available = fixNumber(elem.total_available);
		    	elem._daily_cap = elem.daily_cap;
		    	elem.daily_cap = fixNumber(elem.daily_cap);
		    	elem._daily_available = elem.daily_available;
		    	elem.daily_available = fixNumber(elem.daily_available);
		    	elem._hourly_cap = elem.hourly_cap;
		    	elem.hourly_cap = fixNumber(elem.hourly_cap);
		    	elem._hourly_available = elem.hourly_available;
		    	elem.hourly_available = fixNumber(elem.hourly_available);
	  		});
  		}

		return data
  	}

  	function fixMessage(message){
  		return changeAmounts(message).map(function (elem){
  			elem.cmpId = parseInt(elem.cmpId);
  			return elem;
  		});
  	}
  	function getOldValues(data){
  		data.forEach(function (elem){
  			elem.available = elem._available;
	  		elem.spent = elem._spent;
			elem.total = elem._total;
	    	elem.total_available = elem._total_available;
	    	elem.daily_cap = elem._daily_cap;
	    	elem.daily_available = elem._daily_available;
	    	elem.hourly_cap = elem._hourly_cap;
	    	elem.hourly_available = elem._hourly_available;
  		});

  		return data
  	}
  	app.controller('myCtrl', function($scope) {
  		$scope.sortType = 'cmpId';
		$scope.sortReverse = false;
		$scope.searchCmpId = ''; // set the default search/filter term
	  	$('#toggle-event').change(function() {
	      	USD = $(this).prop('checked');
	      	$scope.$apply(function() {
		      	if (!USD){
		      		$scope.data = getOldValues($scope.data)
		      		delete $scope.data.__valueInUSD;
		      		return
		      	}

	      		$scope.data = changeAmounts($scope.data)
	       });
	    });

	  	$scope.tableFilter = function(item) {
	  		if ($scope.searchCmpId == '')
	  			return true;

  			var a = !!$scope.searchCmpId.split(",").find(function (element, index, array){
  				var range = element.split("-");
  				if (range.length == 1){
	  				return range.indexOf(item['cmpId'] + "") >= 0;
	  			}

	  			var low = range[0];
	  			var high = range[1];
	  			return ( parseInt(low) <= item['cmpId'] && item['cmpId'] <= parseInt(high) );
  			});

  			return a;
	    }

		var socket = io();
	  	socket.on('new Data', function(msg){
	    	$scope.$apply(function() {
	            $scope.data = fixMessage(msg);
	       });
	  	});
	});
</script>
</html> -->
